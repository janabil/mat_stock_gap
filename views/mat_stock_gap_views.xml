<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- ======================================================
         Wizard form view — full page, no popup
    ====================================================== -->
    <record id="view_mat_stock_gap_form" model="ir.ui.view">
        <field name="name">mat.stock.gap.form</field>
        <field name="model">mat.stock.gap</field>
        <field name="arch" type="xml">
            <form string="Analyse Écart de Stock">
                <sheet>
                    <div class="oe_title">
                        <h2>Analyse Écart de Stock</h2>
                    </div>
                    <group string="Paramètres">
                        <group>
                            <field name="warehouse_id"/>
                            <field name="date_from"/>
                        </group>
                        <group>
                            <field name="date_to"/>
                        </group>
                    </group>
                    <div class="o_row mt-3">
                        <button
                            name="action_compute"
                            type="object"
                            string="Calculer l'écart"
                            class="btn btn-primary"
                        />
                    </div>

                    <div class="mt-4 p-3" style="background:#f8f9fa; border-radius:6px; border:1px solid #dee2e6;">
                        <strong>Légende des couleurs dans les résultats :</strong>
                        <ul class="mb-0 mt-2" style="list-style:none; padding-left:0;">
                            <li class="mb-1">
                                <span style="display:inline-block; width:14px; height:14px; background:#dc3545; border-radius:3px; vertical-align:middle; margin-right:6px;"/>
                                <strong>Rouge — Écart positif :</strong> le stock réel est inférieur au stock théorique.
                                Produits potentiellement manquants ou perdus.
                            </li>
                            <li class="mb-1">
                                <span style="display:inline-block; width:14px; height:14px; background:#fd7e14; border-radius:3px; vertical-align:middle; margin-right:6px;"/>
                                <strong>Orange — Écart négatif :</strong> le stock réel est supérieur au stock théorique.
                                Réception ou retour non enregistré.
                            </li>
                            <li>
                                <span style="display:inline-block; width:14px; height:14px; background:#28a745; border-radius:3px; vertical-align:middle; margin-right:6px;"/>
                                <strong>Vert — Aucun écart :</strong> stock théorique = stock réel. Tout est correct.
                            </li>
                        </ul>
                        <div class="mt-2 text-muted" style="font-size:0.85em;">
                            Formule : <strong>Écart = (Stock début &#8722; Ventes POS + Réceptions) &#8722; Stock réel</strong>
                        </div>
                    </div>
                </sheet>
            </form>
        </field>
    </record>

    <!-- ======================================================
         Standalone list view for results — export available here
    ====================================================== -->
    <record id="view_mat_stock_gap_line_list" model="ir.ui.view">
        <field name="name">mat.stock.gap.line.list</field>
        <field name="model">mat.stock.gap.line</field>
        <field name="arch" type="xml">
            <list
                string="Analyse Écart de Stock — Résultats"
                decoration-danger="qty_gap &gt; 0"
                decoration-warning="qty_gap &lt; 0"
                decoration-success="qty_gap == 0.0"
                create="false"
                delete="false"
            >
                <field name="product_id"      string="Produit"/>
                <field name="default_code"    string="Référence"       optional="show"/>
                <field name="categ_id"        string="Catégorie"       optional="show"/>
                <field name="qty_start"       string="Stock début"     digits="[16,2]"/>
                <field name="qty_received"    string="Réceptions"      digits="[16,2]"/>
                <field name="qty_sold"        string="Ventes POS"      digits="[16,2]"/>
                <field name="qty_theoretical" string="Stock théorique" digits="[16,2]"/>
                <field name="qty_actual"      string="Stock réel"      digits="[16,2]"/>
                <field name="qty_gap"         string="Écart"           digits="[16,2]"/>
            </list>
        </field>
    </record>

    <!-- ======================================================
         Action — wizard form, full page
    ====================================================== -->
    <record id="action_mat_stock_gap" model="ir.actions.act_window">
        <field name="name">Analyse Écart de Stock</field>
        <field name="res_model">mat.stock.gap</field>
        <field name="view_mode">form</field>
        <field name="target">current</field>
    </record>

    <!-- ======================================================
         Menu item — Inventory > Reporting
    ====================================================== -->
    <menuitem
        id="menu_mat_stock_gap"
        name="Analyse Écart de Stock"
        parent="stock.menu_warehouse_report"
        action="action_mat_stock_gap"
        sequence="100"
    />

</odoo>
